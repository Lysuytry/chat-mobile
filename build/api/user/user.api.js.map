{"version":3,"sources":["../../../src/api/user/user.api.js"],"names":["getUserList","req","res","limit","skip","query","user","count","Promise","all","User","aggregate","$limit","$skip","success","error","fail","stack","createUser","username","channelId","body","check","findOne","socketId","$ne","findOneAndUpdate","$in","$set","upsert","new","console","log","updateUser","id","params","updateOne","_id","deleteUser","getUserById","result","findById"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,oCAAc,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAI;AACF,UAAM,EAAEC,KAAF,EAASC,IAAT,KAAkBH,IAAII,KAA5B;AACA,UAAM,CAACC,IAAD,EAAOC,KAAP,IAAgB,MAAMC,QAAQC,GAAR,CAAY,CAACC,eAAKC,SAAL,CAAe,CAAC,EAAEC,QAAQT,KAAV,EAAD,EAAoB,EAAEU,OAAOT,IAAT,EAApB,CAAf,CAAD,EAAuDM,eAAKH,KAAL,EAAvD,CAAZ,CAA5B;AACAL,QAAIY,OAAJ,CAAYR,IAAZ,EAAkB,EAAEC,OAAO,CAACA,KAAV,EAAiBJ,KAAjB,EAAwBC,IAAxB,EAAlB;AACD,GAJD,CAIE,OAAOW,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,MAAME,KAAf;AACD;AACF,CARM;;AAUA,MAAMC,kCAAa,OAAOjB,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAEiB,QAAF,EAAYC,SAAZ,KAA0BnB,IAAIoB,IAApC;AACA,UAAMC,QAAQ,MAAMZ,eAAKa,OAAL,CAAa,EAAEJ,QAAF,EAAYC,SAAZ,EAAuBI,UAAU,EAAEC,KAAK,IAAP,EAAjC,EAAb,CAApB;AACA,QAAIH,KAAJ,EAAW,OAAOpB,IAAIc,IAAJ,CAAS,4BAAT,EAAuC,GAAvC,CAAP;AACX,UAAMV,OAAO,MAAMI,eAAKgB,gBAAL,CACjB,EAAEP,QAAF,EAAYC,WAAW,EAAEO,KAAK,CAAC,IAAD,EAAOP,SAAP,CAAP,EAAvB,EAAmDI,UAAU,IAA7D,EADiB,EAEjB,EAAEI,MAAM3B,IAAIoB,IAAZ,EAFiB,EAGjB,EAAEQ,QAAQ,IAAV,EAAgBC,KAAK,IAArB,EAHiB,CAAnB;AAKA;AACA,WAAO5B,IAAIY,OAAJ,CAAYR,IAAZ,CAAP;AACD,GAXD,CAWE,OAAOS,KAAP,EAAc;AACdgB,YAAQC,GAAR,CAAYjB,MAAME,KAAlB;AACA,WAAOf,IAAIc,IAAJ,CAAS,oBAAT,CAAP;AACD;AACF,CAhBM;;AAkBA,MAAMiB,kCAAa,OAAOhC,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAEgC,EAAF,KAASjC,IAAIkC,MAAnB;AACA,UAAMzB,eAAK0B,SAAL,CAAe,EAAEC,KAAKH,EAAP,EAAf,EAA4B,EAAEN,MAAM3B,IAAIoB,IAAZ,EAA5B,CAAN;AACAnB,QAAIY,OAAJ,CAAY,uBAAZ;AACD,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM;;AAUA,MAAMuB,kCAAa,OAAOrC,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAEgC,EAAF,KAASjC,IAAIkC,MAAnB;AACA,UAAM,0BAAeD,EAAf,CAAN;AACAhC,QAAIY,OAAJ,CAAY,uBAAZ;AACD,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM;;AAUA,MAAMwB,oCAAc,OAAOtC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAI;AACF,UAAM,EAAEgC,EAAF,KAASjC,IAAIkC,MAAnB;AACA,UAAMK,SAAS,MAAM9B,eAAK+B,QAAL,CAAcP,EAAd,CAArB;AACAhC,QAAIY,OAAJ,CAAY0B,MAAZ;AACD,GAJD,CAIE,OAAOzB,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM","file":"user.api.js","sourcesContent":["import User, { deleteUserById } from '../../models/user';\n\nexport const getUserList = async (req, res) => {\n  try {\n    const { limit, skip } = req.query;\n    const [user, count] = await Promise.all([User.aggregate([{ $limit: limit }, { $skip: skip }]), User.count()]);\n    res.success(user, { count: +count, limit, skip });\n  } catch (error) {\n    res.fail(error.stack);\n  }\n};\n\nexport const createUser = async (req, res) => {\n  try {\n    const { username, channelId } = req.body;\n    const check = await User.findOne({ username, channelId, socketId: { $ne: null } });\n    if (check) return res.fail('Username is already taken!', 500);\n    const user = await User.findOneAndUpdate(\n      { username, channelId: { $in: [null, channelId] }, socketId: null },\n      { $set: req.body },\n      { upsert: true, new: true }\n    );\n    //const user = await User.create(req.body);\n    return res.success(user);\n  } catch (error) {\n    console.log(error.stack);\n    return res.fail('create user error.');\n  }\n};\n\nexport const updateUser = async (req, res) => {\n  try {\n    const { id } = req.params;\n    await User.updateOne({ _id: id }, { $set: req.body });\n    res.success('Updated Successfully.');\n  } catch (error) {\n    res.fail(error);\n  }\n};\n\nexport const deleteUser = async (req, res) => {\n  try {\n    const { id } = req.params;\n    await deleteUserById(id);\n    res.success('Successfully deleted.');\n  } catch (error) {\n    res.fail(error);\n  }\n};\n\nexport const getUserById = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const result = await User.findById(id);\n    res.success(result);\n  } catch (error) {\n    res.fail(error);\n  }\n};\n"]}