{"version":3,"sources":["../../../src/api/user/user.api.js"],"names":["DBNAME","process","env","getUserList","req","res","limit","skip","query","user","count","Promise","all","User","aggregate","$limit","$skip","success","error","fail","stack","createUser","create","body","message","code","Object","values","indexOf","updateUser","id","params","updateOne","_id","$set","deleteUser","getUserById","result","findById"],"mappings":";;;;;;;AAAA;;;;;;AACA,MAAM,EAAEA,MAAF,KAAaC,QAAQC,GAA3B;AACO,MAAMC,oCAAc,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAI;AACF,UAAM,EAAEC,KAAF,EAASC,IAAT,KAAkBH,IAAII,KAA5B;AACA,UAAM,CAACC,IAAD,EAAOC,KAAP,IAAgB,MAAMC,QAAQC,GAAR,CAAY,CAACC,eAAKC,SAAL,CAAe,CAAC,EAAEC,QAAQT,KAAV,EAAD,EAAoB,EAAEU,OAAOT,IAAT,EAApB,CAAf,CAAD,EAAuDM,eAAKH,KAAL,EAAvD,CAAZ,CAA5B;AACAL,QAAIY,OAAJ,CAAYR,IAAZ,EAAkB,EAAEC,OAAO,CAACA,KAAV,EAAiBJ,KAAjB,EAAwBC,IAAxB,EAAlB;AACD,GAJD,CAIE,OAAOW,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,MAAME,KAAf;AACD;AACF,CARM;;AAUA,MAAMC,kCAAa,OAAOjB,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAMI,OAAO,MAAMI,eAAKS,MAAL,CAAYlB,IAAImB,IAAhB,CAAnB;AACAlB,QAAIY,OAAJ,CAAYR,IAAZ;AACD,GAHD,CAGE,OAAOS,KAAP,EAAc;AACd,QAAIM,OAAJ,CADc,CACD;AACb,QAAIN,MAAMO,IAAN,KAAe,KAAnB,EAA0B;AACxBD,gBACEE,OAAOC,MAAP,CAAcT,MAAMM,OAApB,EAA6BI,OAA7B,CAAsC,qCAAoC5B,MAAO,2BAAjF,IAA+G,CAAC,CAAhH,GAAoH,iBAApH,GAAwI,oBAD1I;AAED,KAHD,MAGO;AACLwB,gBAAUN,MAAMM,OAAhB;AACD;AACDnB,QAAIc,IAAJ,CAASK,OAAT;AACD;AACF,CAdM;;AAgBA,MAAMK,kCAAa,OAAOzB,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAEyB,EAAF,KAAS1B,IAAI2B,MAAnB;AACA,UAAMlB,eAAKmB,SAAL,CAAe,EAAEC,KAAKH,EAAP,EAAf,EAA4B,EAAEI,MAAM9B,IAAImB,IAAZ,EAA5B,CAAN;AACAlB,QAAIY,OAAJ,CAAY,uBAAZ;AACD,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM;;AAUA,MAAMiB,kCAAa,OAAO/B,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAEyB,EAAF,KAAS1B,IAAI2B,MAAnB;AACA,UAAM,0BAAeD,EAAf,CAAN;AACAzB,QAAIY,OAAJ,CAAY,uBAAZ;AACD,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM;;AAUA,MAAMkB,oCAAc,OAAOhC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAI;AACF,UAAM,EAAEyB,EAAF,KAAS1B,IAAI2B,MAAnB;AACA,UAAMM,SAAS,MAAMxB,eAAKyB,QAAL,CAAcR,EAAd,CAArB;AACAzB,QAAIY,OAAJ,CAAYoB,MAAZ;AACD,GAJD,CAIE,OAAOnB,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM","file":"user.api.js","sourcesContent":["import User, { deleteUserById } from '../../models/user';\r\nconst { DBNAME } = process.env;\r\nexport const getUserList = async (req, res) => {\r\n  try {\r\n    const { limit, skip } = req.query;\r\n    const [user, count] = await Promise.all([User.aggregate([{ $limit: limit }, { $skip: skip }]), User.count()]);\r\n    res.success(user, { count: +count, limit, skip });\r\n  } catch (error) {\r\n    res.fail(error.stack);\r\n  }\r\n};\r\n\r\nexport const createUser = async (req, res) => {\r\n  try {\r\n    const user = await User.create(req.body);\r\n    res.success(user);\r\n  } catch (error) {\r\n    let message; // = error.code === 11000 ? 'Username or Email is taken.' : error.message;\r\n    if (error.code === 11000) {\r\n      message =\r\n        Object.values(error.message).indexOf(`E11000 duplicate key error index: ${DBNAME}.users.$email_1 dup key: `) > -1 ? 'Email is taken.' : 'Username is taken.';\r\n    } else {\r\n      message = error.message;\r\n    }\r\n    res.fail(message);\r\n  }\r\n};\r\n\r\nexport const updateUser = async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    await User.updateOne({ _id: id }, { $set: req.body });\r\n    res.success('Updated Successfully.');\r\n  } catch (error) {\r\n    res.fail(error);\r\n  }\r\n};\r\n\r\nexport const deleteUser = async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    await deleteUserById(id);\r\n    res.success('Successfully deleted.');\r\n  } catch (error) {\r\n    res.fail(error);\r\n  }\r\n};\r\n\r\nexport const getUserById = async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const result = await User.findById(id);\r\n    res.success(result);\r\n  } catch (error) {\r\n    res.fail(error);\r\n  }\r\n};\r\n"]}