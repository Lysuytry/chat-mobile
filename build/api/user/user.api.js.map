{"version":3,"sources":["../../../src/api/user/user.api.js"],"names":["getUserList","req","res","limit","skip","query","user","count","Promise","all","User","aggregate","$limit","$skip","success","error","fail","stack","createUser","username","body","findOneAndUpdate","$set","new","upsert","message","code","updateUser","id","params","updateOne","_id","deleteUser","getUserById","result","findById"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,oCAAc,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAI;AACF,UAAM,EAAEC,KAAF,EAASC,IAAT,KAAkBH,IAAII,KAA5B;AACA,UAAM,CAACC,IAAD,EAAOC,KAAP,IAAgB,MAAMC,QAAQC,GAAR,CAAY,CAACC,eAAKC,SAAL,CAAe,CAAC,EAAEC,QAAQT,KAAV,EAAD,EAAoB,EAAEU,OAAOT,IAAT,EAApB,CAAf,CAAD,EAAuDM,eAAKH,KAAL,EAAvD,CAAZ,CAA5B;AACAL,QAAIY,OAAJ,CAAYR,IAAZ,EAAkB,EAAEC,OAAO,CAACA,KAAV,EAAiBJ,KAAjB,EAAwBC,IAAxB,EAAlB;AACD,GAJD,CAIE,OAAOW,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,MAAME,KAAf;AACD;AACF,CARM;;AAUA,MAAMC,kCAAa,OAAOjB,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAEiB,QAAF,KAAelB,IAAImB,IAAzB;AACA,UAAMd,OAAO,MAAMI,eAAKW,gBAAL,CAAsB,EAAEF,QAAF,EAAtB,EAAoC,EAAEG,MAAMrB,IAAImB,IAAZ,EAApC,EAAwD,EAACG,KAAK,IAAN,EAAYC,QAAQ,IAApB,EAAxD,CAAnB;AACAtB,QAAIY,OAAJ,CAAYR,IAAZ;AACD,GAJD,CAIE,OAAOS,KAAP,EAAc;AACd,UAAMU,UAAUV,MAAMW,IAAN,KAAe,KAAf,GAAuB,oBAAvB,GAA8CD,QAAQA,OAAtE;AACAvB,QAAIc,IAAJ,CAASS,OAAT;AACD;AACF,CATM;;AAWA,MAAME,kCAAa,OAAO1B,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAE0B,EAAF,KAAS3B,IAAI4B,MAAnB;AACA,UAAMnB,eAAKoB,SAAL,CAAe,EAAEC,KAAKH,EAAP,EAAf,EAA4B,EAAEN,MAAMrB,IAAImB,IAAZ,EAA5B,CAAN;AACAlB,QAAIY,OAAJ,CAAY,uBAAZ;AACD,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM;;AAUA,MAAMiB,kCAAa,OAAO/B,GAAP,EAAYC,GAAZ,KAAoB;AAC5C,MAAI;AACF,UAAM,EAAE0B,EAAF,KAAS3B,IAAI4B,MAAnB;AACA,UAAM,0BAAeD,EAAf,CAAN;AACA1B,QAAIY,OAAJ,CAAY,uBAAZ;AACD,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM;;AAUA,MAAMkB,oCAAc,OAAOhC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAI;AACF,UAAM,EAAE0B,EAAF,KAAS3B,IAAI4B,MAAnB;AACA,UAAMK,SAAS,MAAMxB,eAAKyB,QAAL,CAAcP,EAAd,CAArB;AACA1B,QAAIY,OAAJ,CAAYoB,MAAZ;AACD,GAJD,CAIE,OAAOnB,KAAP,EAAc;AACdb,QAAIc,IAAJ,CAASD,KAAT;AACD;AACF,CARM","file":"user.api.js","sourcesContent":["import User, { deleteUserById } from '../../models/user';\n\nexport const getUserList = async (req, res) => {\n  try {\n    const { limit, skip } = req.query;\n    const [user, count] = await Promise.all([User.aggregate([{ $limit: limit }, { $skip: skip }]), User.count()]);\n    res.success(user, { count: +count, limit, skip });\n  } catch (error) {\n    res.fail(error.stack);\n  }\n};\n\nexport const createUser = async (req, res) => {\n  try {\n    const { username } = req.body;\n    const user = await User.findOneAndUpdate({ username }, { $set: req.body }, {new: true, upsert: true});\n    res.success(user);\n  } catch (error) {\n    const message = error.code === 11000 ? 'Username is taken.' : message.message;\n    res.fail(message);\n  }\n};\n\nexport const updateUser = async (req, res) => {\n  try {\n    const { id } = req.params;\n    await User.updateOne({ _id: id }, { $set: req.body });\n    res.success('Updated Successfully.');\n  } catch (error) {\n    res.fail(error);\n  }\n};\n\nexport const deleteUser = async (req, res) => {\n  try {\n    const { id } = req.params;\n    await deleteUserById(id);\n    res.success('Successfully deleted.');\n  } catch (error) {\n    res.fail(error);\n  }\n};\n\nexport const getUserById = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const result = await User.findById(id);\n    res.success(result);\n  } catch (error) {\n    res.fail(error);\n  }\n};\n"]}